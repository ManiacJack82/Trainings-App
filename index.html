<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trainings App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(to bottom right, #0f2027, #203a43, #2c5364);
      color: #fff;
      padding: 10px;
      max-width: 500px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    form, table, .custom-section, .tabs {
      background: rgba(255,255,255,0.1);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      margin-bottom: 20px;
    }
    label, select, input, button {
      display: block;
      width: 100%;
      margin-bottom: 10px;
      font-size: 1rem;
    }
    input, select {
      padding: 8px;
      border-radius: 8px;
      border: none;
      box-sizing: border-box;
    }
    button {
      background-color: #00c896;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #009f74;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #ccc;
      color: white;
      text-align: center;
    }
    .diff-arrow {
      font-weight: bold;
      margin-left: 5px;
    }
    .diff-positive { color: #00ff99; }
    .diff-negative { color: #ff4c4c; }
    .diff-neutral  { color: #999; }
    #uebungenList button, #geraeteList button {
      background: #b32c00;
      color: white;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      box-shadow: 0 3px 6px #7f1a00;
      transition: background-color 0.3s ease;
      user-select: none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    #uebungenContainer.collapsed #uebungenList,
    #geraeteContainer.collapsed #geraeteList {
      display: none;
    }
    #toggleUebungen, #toggleGeraete {
      background: #004f4f;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .tab-header button {
      background: #006d77;
      color: white;
      border: none;
      padding: 10px;
      margin: 0 5px 10px 0;
      border-radius: 8px;
      cursor: pointer;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    #loginContainer {
      max-width: 350px;
      margin: 40px auto;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    #loginContainer label {
      margin-top: 10px;
    }
    #loginContainer button {
      margin-top: 15px;
      background-color: #0077cc;
    }
    #loginContainer button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>

  <h1>Trainings App</h1>

  <div id="loginContainer">
    <form id="loginForm">
      <label for="email">E-Mail:</label>
      <input type="email" id="email" required placeholder="Deine E-Mail" />
      <label for="password">Passwort:</label>
      <input type="password" id="password" required placeholder="Dein Passwort" />
      <button type="submit">Login</button>
    </form>
  </div>

  <div class="tabs" style="display:none;">
    <div class="tab-header">
      <button onclick="switchTab('statsTab')">üìä Statistiken</button>
      <button onclick="switchTab('formTab')">üìã Training</button>
    </div>
    <div id="statsTab" class="tab-content">
      <canvas id="geraetChart"></canvas>
      <canvas id="wochenChart"></canvas>
    </div>
    <div id="formTab" class="tab-content active">

      <div class="custom-section" id="uebungenContainer">
        <h3>√úbung hinzuf√ºgen</h3>
        <input id="neueUebung" placeholder="Name der √úbung" />
        <button id="hinzufuegenUebung">Hinzuf√ºgen</button>
        <button id="toggleUebungen">√úbungsliste ein-/ausklappen</button>
        <ul id="uebungenList"></ul>
      </div>

      <div class="custom-section" id="geraeteContainer">
        <h3>Ger√§t hinzuf√ºgen</h3>
        <input id="neuesGeraet" placeholder="Name des Ger√§ts" />
        <button id="hinzufuegenGeraet">Hinzuf√ºgen</button>
        <button id="toggleGeraete">Ger√§teliste ein-/ausklappen</button>
        <ul id="geraeteList"></ul>
      </div>

      <form id="trainingForm">
        <label>√úbung:</label>
        <select id="uebungSelect"></select>

        <label>Ger√§t:</label>
        <select id="geraetSelect"></select>

        <label>Wiederholungen:</label>
        <input type="number" id="wdh" min="1" required />

        <label>Gewicht (kg):</label>
        <input type="number" id="gewicht" min="0" step="0.5" required />

        <button type="submit">Eintragen</button>
      </form>

      <table id="tabelle" hidden>
        <thead>
          <tr><th>Datum</th><th>√úbung</th><th>Ger√§t</th><th>Wdh</th><th>Gewicht</th><th>Aktion</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // --- Datenarrays ---
    const eintraege = [];
    const uebungen = [];
    const geraete = [];

    // --- DOM Elemente ---
    const loginContainer = document.getElementById('loginContainer');
    const loginForm = document.getElementById('loginForm');
    const tabs = document.querySelector('.tabs');
    const uebungSelect = document.getElementById('uebungSelect');
    const geraetSelect = document.getElementById('geraetSelect');
    const wdhInput = document.getElementById('wdh');
    const gewichtInput = document.getElementById('gewicht');
    const tbody = document.querySelector('#tabelle tbody');
    const tabelle = document.getElementById('tabelle');

    // Buttons & Listen
    const uebungenList = document.getElementById('uebungenList');
    const hinzufuegenUebungBtn = document.getElementById('hinzufuegenUebung');
    const toggleUebungenBtn = document.getElementById('toggleUebungen');
    const uebungenContainer = document.getElementById('uebungenContainer');

    const geraeteList = document.getElementById('geraeteList');
    const hinzufuegenGeraetBtn = document.getElementById('hinzufuegenGeraet');
    const toggleGeraeteBtn = document.getElementById('toggleGeraete');
    const geraeteContainer = document.getElementById('geraeteContainer');

    // Charts
    let geraetChart, wochenChart;

    // --- Login Funktion ---
    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      // Einfacher Dummy-Login: wenn Email + Passwort nicht leer, dann "eingeloggt"
      const email = loginForm.email.value.trim();
      const passwort = loginForm.password.value.trim();
      if(email && passwort){
        loginContainer.style.display = 'none';
        tabs.style.display = 'block';
        ladeDaten();
        switchTab('formTab');
      } else {
        alert('Bitte E-Mail und Passwort eingeben.');
      }
    });

    // --- Tab Umschalten ---
    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
      if (tabId === 'statsTab') {
        renderCharts();
      }
    }

    // --- √úbungen verwalten ---
    hinzufuegenUebungBtn.addEventListener('click', e => {
      e.preventDefault();
      const name = document.getElementById('neueUebung').value.trim();
      if(name && !uebungen.includes(name)) {
        uebungen.push(name);
        speichereUebungen();
        updateUebungen();
        document.getElementById('neueUebung').value = '';
      }
    });

    function updateUebungen() {
      // Dropdown
      uebungSelect.innerHTML = '';
      uebungen.forEach(uebung => {
        const opt = document.createElement('option');
        opt.textContent = uebung;
        opt.value = uebung;
        uebungSelect.appendChild(opt);
      });
      uebungSelect.selectedIndex = -1;

      // Liste
      uebungenList.innerHTML = '';
      uebungen.forEach((uebung, idx) => {
        const li = document.createElement('li');
        li.textContent = uebung + ' ';
        const btn = document.createElement('button');
        btn.textContent = 'L√∂schen';
        btn.onclick = () => {
          uebungen.splice(idx,1);
          speichereUebungen();
          updateUebungen();
        };
        li.appendChild(btn);
        uebungenList.appendChild(li);
      });
    }

    toggleUebungenBtn.addEventListener('click', e => {
      e.preventDefault();
      uebungenContainer.classList.toggle('collapsed');
    });

    // --- Ger√§te verwalten ---
    hinzufuegenGeraetBtn.addEventListener('click', e => {
      e.preventDefault();
      const name = document.getElementById('neuesGeraet').value.trim();
      if(name && !geraete.includes(name)) {
        geraete.push(name);
        speichereGeraete();
        updateGeraete();
        document.getElementById('neuesGeraet').value = '';
      }
    });

    function updateGeraete() {
      // Dropdown
      geraetSelect.innerHTML = '';
      geraete.forEach(geraet => {
        const opt = document.createElement('option');
        opt.textContent = geraet;
        opt.value = geraet;
        geraetSelect.appendChild(opt);
      });
      geraetSelect.selectedIndex = -1;

      // Liste
      geraeteList.innerHTML = '';
      geraete.forEach((geraet, idx) => {
        const li = document.createElement('li');
        li.textContent = geraet + ' ';
        const btn = document.createElement('button');
        btn.textContent = 'L√∂schen';
        btn.onclick = () => {
          geraete.splice(idx,1);
          speichereGeraete();
          updateGeraete();
        };
        li.appendChild(btn);
        geraeteList.appendChild(li);
      });
    }

    toggleGeraeteBtn.addEventListener('click', e => {
      e.preventDefault();
      geraeteContainer.classList.toggle('collapsed');
    });

    // --- Eintr√§ge bearbeiten ---
    trainingForm.addEventListener('submit', e => {
      e.preventDefault();
      const jetzt = new Date();
      const datum = jetzt.toLocaleDateString('de-DE') + ' ' + jetzt.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
      const uebung = uebungSelect.value;
      const geraet = geraetSelect.value;
      const wdh = Number(wdhInput.value);
      const gewicht = Number(gewichtInput.value);

      if(!uebung) {
        alert('Bitte eine √úbung ausw√§hlen.');
        return;
      }
      if(!geraet) {
        alert('Bitte ein Ger√§t ausw√§hlen.');
        return;
      }
      if(isNaN(wdh) || wdh < 1) {
        alert('Bitte g√ºltige Anzahl der Wiederholungen eingeben.');
        return;
      }
      if(isNaN(gewicht) || gewicht < 0) {
        alert('Bitte g√ºltiges Gewicht eingeben.');
        return;
      }

      eintraege.unshift({ datum, uebung, geraet, wdh, gewicht });
      speichereEintraege();
      renderTable();

      trainingForm.reset();
      uebungSelect.selectedIndex = -1;
      geraetSelect.selectedIndex = -1;
    });

    function renderTable() {
      tbody.innerHTML = '';
      if(eintraege.length) {
        tabelle.hidden = false;
      } else {
        tabelle.hidden = true;
      }

      eintraege.forEach((e, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${e.datum}</td>
          <td>${e.uebung}</td>
          <td>${e.geraet}</td>
          <td>${e.wdh}</td>
          <td>${e.gewicht} kg</td>
          <td><button onclick="loescheEintrag(${idx})">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function loescheEintrag(idx) {
      if(idx >= 0 && idx < eintraege.length) {
        eintraege.splice(idx, 1);
        speichereEintraege();
        renderTable();
      }
    }
    window.loescheEintrag = loescheEintrag; // f√ºr inline onclick

    // --- Daten speichern/laden ---
    function speichereEintraege() {
      localStorage.setItem('eintraege', JSON.stringify(eintraege));
    }
    function speichereUebungen() {
      localStorage.setItem('uebungen', JSON.stringify(uebungen));
    }
    function speichereGeraete() {
      localStorage.setItem('geraete', JSON.stringify(geraete));
    }

    function ladeDaten() {
      const loadedEintraege = JSON.parse(localStorage.getItem('eintraege'));
      if(loadedEintraege) {
        eintraege.push(...loadedEintraege);
      }
      const loadedUebungen = JSON.parse(localStorage.getItem('uebungen'));
      if(loadedUebungen) {
        uebungen.push(...loadedUebungen);
      }
      const loadedGeraete = JSON.parse(localStorage.getItem('geraete'));
      if(loadedGeraete) {
        geraete.push(...loadedGeraete);
      }
      updateUebungen();
      updateGeraete();
      renderTable();
    }

    // --- Charts rendern ---
    function renderCharts() {
      if(!eintraege.length) return;

      // Ger√§testatistik (Anzahl Eintr√§ge pro Ger√§t)
      const geraeteMap = {};
      eintraege.forEach(e => {
        geraeteMap[e.geraet] = (geraeteMap[e.geraet] || 0) + 1;
      });
      const geraeteLabels = Object.keys(geraeteMap);
      const geraeteCounts = Object.values(geraeteMap);

      if(geraetChart) geraetChart.destroy();
      const ctxGeraet = document.getElementById('geraetChart').getContext('2d');
      geraetChart = new Chart(ctxGeraet, {
        type: 'bar',
        data: {
          labels: geraeteLabels,
          datasets: [{
            label: 'Eintr√§ge pro Ger√§t',
            data: geraeteCounts,
            backgroundColor: 'rgba(0,200,150,0.6)',
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } }
        }
      });

      // Wochenstatistik (Anzahl Eintr√§ge pro Wochentag)
      const wochenTage = ['So','Mo','Di','Mi','Do','Fr','Sa'];
      const wochenMap = [0,0,0,0,0,0,0];
      eintraege.forEach(e => {
        // Datum zur√ºckwandeln aus String: "dd.mm.yyyy hh:mm"
        const datumsString = e.datum.split(' ')[0];
        const parts = datumsString.split('.');
        if(parts.length === 3){
          const d = new Date(parts[2], parts[1]-1, parts[0]);
          const tag = d.getDay();
          wochenMap[tag]++;
        }
      });
      if(wochenChart) wochenChart.destroy();
      const ctxWochen = document.getElementById('wochenChart').getContext('2d');
      wochenChart = new Chart(ctxWochen, {
        type: 'line',
        data: {
          labels: wochenTage,
          datasets: [{
            label: 'Trainings pro Wochentag',
            data: wochenMap,
            fill: false,
            borderColor: 'rgba(0,200,150,0.8)',
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } }
        }
      });
    }
  </script>

</body>
</html>
